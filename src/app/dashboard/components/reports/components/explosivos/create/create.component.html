<section class="w-full px-4 py-10">

  <!-- HEADER -->
  <div class="mb-10 flex items-start gap-4">
    <div
      class="w-14 h-14 rounded-2xl flex items-center justify-center
             text-yellow-400
             shadow-[0_20px_40px_-15px_rgba(234,179,8,.9)]">
      <i class="bi bi-shield-exclamation text-2xl"></i>
    </div>

    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-black">
        Explosivos
      </h1>
      <p class="mt-1 text-sm text-black/60 max-w-xl">
        Control de stock, ingresos y consumo de explosivos por turno y responsable.
      </p>
    </div>
  </div>

  <!-- CARD -->
  <div
    class="space-y-10 rounded-3xl border border-black/5
           bg-white p-8
           shadow-[0_40px_100px_-40px_rgba(0,0,0,.5)]">

    <!-- ===============================
         TABLA DE CONTROL
    ================================= -->
    <div class="overflow-hidden rounded-2xl border border-black/5">

      <table class="w-full text-sm">
        <thead class="bg-black/5 uppercase text-xs text-black/70">
          <tr>
            <th class="px-4 py-3 text-left">Explosivo</th>
            <th class="px-4 py-3 text-center">Tipo</th>
            <th class="px-4 py-3 text-center">Stock inicial</th>
            <th class="px-4 py-3 text-center">Ingreso</th>
            <th class="px-4 py-3 text-center">Consumo</th>
            <th class="px-4 py-3 text-center">Stock final</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>

        <tbody>
  <tr
    *ngFor="let row of reporteExplosivos; let i = index; trackBy: trackByIndex"
    class="border-t border-black/5"
  >

    <!-- EXPLOSIVO -->
    <td class="px-4 py-3">
      <select
        [(ngModel)]="row.explosivoId"
        (ngModelChange)="onExplosivoChange(row)"
        name="explosivo-{{i}}"
        class="w-full h-10 px-3 rounded-lg border border-black/10 focus:outline-none focus:ring-4 focus:border-none focus:ring-blue-500/40"
      >
        <option value="">Seleccione</option>
        <option *ngFor="let ex of explosivos" [value]="ex._id">
          {{ ex.nombre }}
        </option>
      </select>
    </td>

    <!-- TIPO -->
    <td class="px-4 py-3 text-center text-black/70">
      {{ row.tipo }}
    </td>

    <!-- STOCK INICIAL -->
    <td class="px-4 py-3 text-center font-semibold text-black/60">
      {{ row.stockInicial }} {{ row.unidad }}
    </td>

    <!-- INGRESO -->
    <td class="px-4 py-3">
      <input
        type="number"
        [(ngModel)]="row.ingreso"
        (ngModelChange)="calcularStock(row)"
        name="ingreso-{{i}}"
        class="w-full h-10 text-center rounded-lg
               border border-green-300 text-green-700 focus:outline-none focus:ring-4 focus:border-none focus:ring-green-500/40"
      />
    </td>

    <!-- CONSUMO -->
    <td class="px-4 py-3">
      <input
        type="number"
        [(ngModel)]="row.consumo"
        (ngModelChange)="calcularStock(row)"
        name="consumo-{{i}}"
        class="w-full h-10 text-center rounded-lg
               border border-red-300 text-red-700 focus:outline-none focus:ring-4 focus:border-none focus:ring-red-500/40"
      />
    </td>

    <!-- STOCK FINAL -->
    <td
      class="px-4 py-3 text-center font-semibold"
      [class.text-yellow-600]="row.stockFinal > 0"
      [class.text-red-600]="row.stockFinal === 0"
    >
      {{ row.stockFinal }} {{ row.unidad }}
    </td>

    <!-- DELETE -->
    <td class="px-4 py-3 text-center">
      <button
        (click)="removeExplosivoRow(i)"
        class="text-red-500 hover:text-red-700 cursor-pointer"
      >
        <i class="bi bi-x-lg"></i>
      </button>
    </td>
  </tr>
</tbody>

      </table>

      <div class="p-4">
        <button
  (click)="addExplosivoRow()"
  class="text-sm font-semibold text-yellow-600 hover:underline cursor-pointer"
>
  + Agregar explosivo
</button>

      </div>
    </div>

  </div>
</section>
