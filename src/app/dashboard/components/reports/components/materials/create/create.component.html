<section class="w-full px-4 py-10">

  <!-- HEADER -->
  <div class="mb-10 flex items-start gap-4">
    <div
      class="w-14 h-14 rounded-2xl flex items-center justify-center
             text-blue-500
             shadow-[0_20px_40px_-15px_rgba(30,41,59,.6)]">
      <i class="bi bi-clipboard-data text-2xl"></i>
    </div>

    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-black">
        Materiales
      </h1>
      <p class="mt-1 text-sm text-black/60 max-w-xl">
        Registro de ingresos y consumos. El stock se calcula autom√°ticamente.
      </p>
    </div>
  </div>

  <!-- FORM -->
  <div
    class="space-y-10 rounded-3xl border border-black/5
           bg-white p-8
           shadow-[0_40px_100px_-40px_rgba(0,0,0,.5)]">

    <!-- TABLA -->
    <div class="overflow-hidden rounded-2xl border border-black/5">

      <table class="w-full text-sm">
        <thead class="bg-black/5 uppercase text-xs text-black/70">
          <tr>
            <th class="px-4 py-3 text-left">Material</th>
            <th class="px-4 py-3 text-center">Stock actual</th>
            <th class="px-4 py-3 text-center">Ingreso</th>
            <th class="px-4 py-3 text-center">Consumo</th>
            <th class="px-4 py-3 text-center">Resultado</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>

        <tbody>

          <tr
            *ngFor="let row of reporteMateriales; let i = index"
            class="border-t border-black/5">

            <!-- MATERIAL -->
            <td class="px-4 py-3">
              <select
                class="w-full h-10 px-3 rounded-lg border border-black/10 focus:outline-none focus:ring-4 focus:border-none focus:ring-blue-500/40"
                [(ngModel)]="row.materialId"
                (ngModelChange)="onMaterialChange(row)"
                name="material-{{i}}">

                <option value="">Seleccione</option>
                <option *ngFor="let m of materiales" [value]="m._id">
                  {{ m.nombre }}
                </option>
              </select>
            </td>

            <!-- STOCK INICIAL -->
            <td class="px-4 py-3 text-center font-semibold text-black/60">
              {{ row.stockInicial }} {{ row.unidad }}
            </td>

            <!-- INGRESO -->
            <td class="px-4 py-3">
              <input
                type="number"
                [(ngModel)]="row.ingreso"
                (ngModelChange)="calcularStock(row)"
                name="ingreso-{{i}}"
                class="w-full h-10 text-center rounded-lg
                      border border-green-300 text-green-700 focus:outline-none focus:ring-4 focus:border-none focus:ring-green-500/40">
            </td>

            <!-- CONSUMO -->
            <td class="px-4 py-3">
              <input
                type="number"
                [(ngModel)]="row.consumo"
                (ngModelChange)="calcularStock(row)"
                name="consumo-{{i}}"
                class="w-full h-10 text-center rounded-lg
                      border border-red-300 text-red-700 focus:outline-none focus:ring-4 focus:border-none focus:ring-red-500/40">
            </td>

            <!-- RESULTADO -->
            <td class="px-4 py-3 text-center font-semibold text-blue-600">
              {{ row.stockFinal }} {{ row.unidad }}
            </td>

            <!-- DELETE -->
            <td class="px-4 py-3 text-center">
              <button
                (click)="removeMaterialRow(i)"
                class="text-red-500 hover:text-red-700 cursor-pointer">
                <i class="bi bi-x-lg"></i>
              </button>
            </td>

          </tr>

        </tbody>

      </table>

      <div class="p-4">
        <button
          (click)="addMaterialRow()"
          class="text-sm font-semibold text-blue-600 hover:underline cursor-pointer">
          + Agregar material
        </button>

      </div>
    </div>

  </div>
</section>
